CRLF MACRO 
MOV DL, 0DH
 MOV AH, 02H
INT 21H ;宏定义了回车,换行
 MOV DL, 0AH
 INT 21H
 ENDM
IOY0 EQU 0E000H ;片选IOY0对应的端口始地址
IOY1 EQU 0E040H ;片选IOY1对应的端口始地址
ADCS EQU IOY0 ;AD0809的端口地址
DACS EQU IOY1 ;DAC0832的端口地址 
STACK1 SEGMENT STACK
DW 256 DUP(?)
STACK1 ENDS
DATA SEGMENT
MES0 DB 'PRESS 1 TO INPUT DATA!',0DH,0AH
DB 'PRESS 2 TO QUIT!',0DH,0AH,0DH,0AH,'$'
MES1 DB '*****PLEASE INPUT DATA OF HEX!*****',0DH,0AH,'$'

MES2 DB '0832 OUTPUT DATA = $'
MES3 DB '0809 INPUT DATA = $'
BUF DB 2 DUP (?)
DATA ENDS
STAC SEGMENT PARA STACK
 DB 256 DUP(?)
STAC ENDS
CODE SEGMENT
 ASSUME CS:CODE,SS:STAC,DS:DATA
START: MOV AX, DATA
 MOV DS, AX 
 LEA DX, MES0
 MOV AH, 9 ;显示MES0
 INT 21H
LOP1: MOV DL, 0FFH
 MOV AH, 6 ;检测键盘输入
 INT 21H
 JZ LOP1
 CMP AL, '1'
 JZ DA
 CMP AL, '2'
 JZ EXIT0
 JMP START
EXIT0: JMP EXIT
DA: LEA DX, MES1
 MOV AH, 9 ;显示MES1
 INT 21H
 LEA DX, MES2
 MOV AH, 9 ;显示MES2
 INT 21H
 MOV AH, 1
 INT 21H
 MOV BUF,AL ;十六进制值存入BUF和BUF[1]
 INT 21H
 MOV BUF[1], AL
MOV AH, 2
CRLF
DA0: MOV AL, BUF
 SUB AL, 30H
 CMP AL, 9 ; 十六进制转换十进制
 JBE A0
 SUB AL, 7
A0: MOV BL, AL ; 十六进制转换十进制
 MOV AL, BUF[1]
 SUB AL, 30H

 CMP AL, 9
 JBE B0
 SUB AL, 7
B0: MOV CL, 4
 ROL BL, CL
 XOR AL, BL
 MOV DX,DACS
 OUT DX,AL
 
AD: MOV DX,ADCS ;启动0809 IN0
 OUT DX,AL
 CALL DELAY
LEA DX, MES3
 MOV AH, 9 ;显示MES2
 INT 21H
 MOV DX,ADCS
IN AL, DX ;读入0809 IN0值
 MOV BL, AL
 AND AL, 0F0H
 MOV CL, 4 ; 显示高位
 ROR AL, CL
CALL CRT1
 MOV AL, BL
 AND AL, 0FH ;显示低位
 CALL CRT1
CRLF
INT 21H
 JMP START
EXIT: MOV AX, 4C00H
 INT 21H
CRT1 PROC 
 ADD AL, 30H 
 CMP AL, 39H
 JBE D0
 ADD AL, 7 ;在屏幕上显示一位16进制字符
D0: MOV DL, AL 
 MOV AH, 2
 INT 21H
RET
CRT1 ENDP
DELAY PROC NEAR
 PUSH CX
 MOV CX, 0FFFFH

 LOOP $ ;延时
 POP CX
 RET
DELAY ENDP
CODE ENDS
 END START
